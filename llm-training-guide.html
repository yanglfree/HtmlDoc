<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¦‚ä½•è®­ç»ƒä¸€ä¸ªå¤§è¯­è¨€æ¨¡å‹ - å¿«é€ŸæŸ¥è¯¢æ‰‹å†Œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0d1117;
            --bg2: #161b22;
            --bg3: #21262d;
            --text: #e6edf3;
            --text2: #8b949e;
            --blue: #58a6ff;
            --green: #3fb950;
            --purple: #a371f7;
            --orange: #d29922;
            --cyan: #39c5cf;
            --pink: #f778ba;
            --border: #30363d
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 24px
        }

        .hero {
            text-align: center;
            padding: 48px 24px;
            margin-bottom: 48px;
            background: linear-gradient(135deg, rgba(248, 81, 73, 0.15), rgba(163, 113, 247, 0.15));
            border-radius: 16px;
            border: 1px solid var(--border)
        }

        .hero h1 {
            font-size: 34px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #f85149, var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent
        }

        .hero p {
            color: var(--text2);
            font-size: 16px
        }

        .section {
            margin-bottom: 48px
        }

        .section h2 {
            font-size: 22px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px
        }

        .section h2::before {
            content: '';
            width: 4px;
            height: 22px;
            background: linear-gradient(#f85149, var(--purple));
            border-radius: 2px
        }

        .section h3 {
            font-size: 18px;
            margin: 24px 0 16px;
            color: #f85149
        }

        p {
            margin-bottom: 16px;
            color: var(--text2)
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg3);
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 13px;
            color: var(--cyan)
        }

        pre {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.8;
            margin: 16px 0
        }

        pre code {
            background: none;
            padding: 0;
            color: var(--text)
        }

        .comment {
            color: var(--text2)
        }

        .keyword {
            color: var(--purple)
        }

        .string {
            color: var(--green)
        }

        .number {
            color: var(--orange)
        }

        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin: 20px 0
        }

        .card {
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            transition: all .2s
        }

        .card:hover {
            border-color: #f85149;
            transform: translateY(-2px)
        }

        .card h3 {
            font-size: 16px;
            color: #f85149;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px
        }

        .card p,
        .card li {
            font-size: 14px;
            color: var(--text2);
            margin: 0
        }

        .card ul {
            margin: 8px 0 0 16px
        }

        .tip {
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid rgba(248, 81, 73, 0.3);
            border-radius: 12px;
            padding: 16px 20px;
            margin: 20px 0
        }

        .tip.info {
            background: rgba(88, 166, 255, 0.1);
            border-color: rgba(88, 166, 255, 0.3)
        }

        .tip.success {
            background: rgba(63, 185, 80, 0.1);
            border-color: rgba(63, 185, 80, 0.3)
        }

        .tip strong {
            display: block;
            margin-bottom: 6px;
            color: #f85149
        }

        .tip.info strong {
            color: var(--blue)
        }

        .tip.success strong {
            color: var(--green)
        }

        .flow {
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0
        }

        .flow-title {
            font-size: 14px;
            color: var(--text2);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px
        }

        .flow-steps {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px
        }

        .flow-step {
            background: var(--bg3);
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 13px;
            font-weight: 500
        }

        .flow-arrow {
            color: #f85149;
            font-size: 16px
        }

        .phase {
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0
        }

        .phase-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px
        }

        .phase-num {
            background: #f85149;
            color: #fff;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px
        }

        .phase-title {
            font-size: 18px;
            font-weight: 600
        }

        .phase-content {
            color: var(--text2);
            font-size: 14px
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            background: var(--bg2);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            margin: 16px 0
        }

        th {
            background: var(--bg3);
            padding: 14px 16px;
            text-align: left;
            font-weight: 600
        }

        td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border)
        }

        tr:last-child td {
            border-bottom: none
        }

        .toc {
            position: fixed;
            top: 40px;
            right: 40px;
            width: 200px;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px
        }

        .toc h3 {
            font-size: 12px;
            color: var(--text2);
            text-transform: uppercase;
            margin-bottom: 12px
        }

        .toc a {
            display: block;
            padding: 6px 0;
            color: var(--text2);
            text-decoration: none;
            font-size: 13px
        }

        .toc a:hover {
            color: #f85149
        }

        @media(max-width:1200px) {
            .toc {
                display: none
            }
        }

        @media(max-width:768px) {
            .container {
                padding: 24px 16px
            }

            .hero h1 {
                font-size: 26px
            }

            .cards {
                grid-template-columns: 1fr
            }

            .flow-steps {
                flex-direction: column
            }

            .flow-arrow {
                transform: rotate(90deg)
            }
        }
    </style>
</head>

<body>
    <nav class="toc">
        <h3>ç›®å½•</h3><a href="#overview">è®­ç»ƒæ¦‚è§ˆ</a><a href="#data">æ•°æ®å‡†å¤‡</a><a href="#pretrain">é¢„è®­ç»ƒ</a><a
            href="#sft">æŒ‡ä»¤å¾®è°ƒ</a><a href="#rlhf">RLHFå¯¹é½</a><a href="#infra">è®­ç»ƒåŸºç¡€è®¾æ–½</a><a href="#eval">è¯„ä¼°æ–¹æ³•</a><a
            href="#cost">æˆæœ¬ä¼°ç®—</a>
    </nav>

    <div class="container">
        <div class="hero">
            <h1>ğŸ§  å¦‚ä½•è®­ç»ƒä¸€ä¸ªå¤§è¯­è¨€æ¨¡å‹</h1>
            <p>ä»æ•°æ®åˆ°æ¨¡å‹ - LLM è®­ç»ƒå…¨æµç¨‹æŠ€æœ¯æŒ‡å—</p>
        </div>

        <section id="overview" class="section">
            <h2>è®­ç»ƒæµç¨‹æ¦‚è§ˆ</h2>
            <p>è®­ç»ƒä¸€ä¸ªç°ä»£å¤§è¯­è¨€æ¨¡å‹é€šå¸¸åŒ…å«ä¸‰ä¸ªä¸»è¦é˜¶æ®µï¼šé¢„è®­ç»ƒã€æŒ‡ä»¤å¾®è°ƒï¼ˆSFTï¼‰å’Œäººç±»åé¦ˆå¼ºåŒ–å­¦ä¹ ï¼ˆRLHFï¼‰ã€‚</p>

            <div class="flow">
                <div class="flow-title">LLM è®­ç»ƒä¸‰é˜¶æ®µ</div>
                <div class="flow-steps">
                    <div class="flow-step">ğŸ“š é¢„è®­ç»ƒ (Pre-training)</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">ğŸ¯ æŒ‡ä»¤å¾®è°ƒ (SFT)</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">ğŸ‘¤ RLHF å¯¹é½</div>
                </div>
            </div>

            <div class="cards">
                <div class="card">
                    <h3>ğŸ“š é¢„è®­ç»ƒ</h3>
                    <p>åœ¨æµ·é‡æ— æ ‡æ³¨æ–‡æœ¬ä¸Šè®­ç»ƒï¼Œå­¦ä¹ è¯­è¨€çš„ç»Ÿè®¡è§„å¾‹å’Œä¸–ç•ŒçŸ¥è¯†</p>
                    <ul>
                        <li>æ•°æ®é‡ï¼šTBçº§æ–‡æœ¬</li>
                        <li>ç®—åŠ›ï¼šæ•°åƒGPUå¤©</li>
                        <li>ç›®æ ‡ï¼šä¸‹ä¸€tokené¢„æµ‹</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>ğŸ¯ æŒ‡ä»¤å¾®è°ƒ</h3>
                    <p>ä½¿ç”¨é«˜è´¨é‡æŒ‡ä»¤-å›ç­”æ•°æ®ï¼Œè®©æ¨¡å‹å­¦ä¼šéµå¾ªæŒ‡ä»¤</p>
                    <ul>
                        <li>æ•°æ®é‡ï¼š10K-1Mæ ·æœ¬</li>
                        <li>ç®—åŠ›ï¼šæ•°åGPUå¤©</li>
                        <li>ç›®æ ‡ï¼šå¯¹é½äººç±»æ„å›¾</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>ğŸ‘¤ RLHF</h3>
                    <p>é€šè¿‡äººç±»åå¥½åé¦ˆï¼Œä¼˜åŒ–æ¨¡å‹è¾“å‡ºè´¨é‡å’Œå®‰å…¨æ€§</p>
                    <ul>
                        <li>è®­ç»ƒå¥–åŠ±æ¨¡å‹</li>
                        <li>PPOå¼ºåŒ–å­¦ä¹ </li>
                        <li>ç›®æ ‡ï¼šå®‰å…¨ã€æœ‰å¸®åŠ©</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="data" class="section">
            <h2>æ•°æ®å‡†å¤‡</h2>
            <p>æ•°æ®æ˜¯LLMè®­ç»ƒçš„åŸºçŸ³ï¼Œæ•°æ®è´¨é‡ç›´æ¥å†³å®šæ¨¡å‹èƒ½åŠ›ä¸Šé™ã€‚</p>

            <h3>é¢„è®­ç»ƒæ•°æ®æ¥æº</h3>
            <table>
                <thead>
                    <tr>
                        <th>æ•°æ®ç±»å‹</th>
                        <th>æ¥æºç¤ºä¾‹</th>
                        <th>è§„æ¨¡</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ç½‘é¡µæ•°æ®</td>
                        <td>Common Crawl, C4</td>
                        <td>æ•°ç™¾TB</td>
                    </tr>
                    <tr>
                        <td>ä¹¦ç±</td>
                        <td>Books3, Gutenberg</td>
                        <td>æ•°ç™¾GB</td>
                    </tr>
                    <tr>
                        <td>ä»£ç </td>
                        <td>GitHub, Stack Overflow</td>
                        <td>æ•°ç™¾GB</td>
                    </tr>
                    <tr>
                        <td>å­¦æœ¯è®ºæ–‡</td>
                        <td>arXiv, PubMed</td>
                        <td>æ•°åGB</td>
                    </tr>
                    <tr>
                        <td>ç»´åŸºç™¾ç§‘</td>
                        <td>Wikipedia</td>
                        <td>æ•°åGB</td>
                    </tr>
                    <tr>
                        <td>ç¤¾äº¤åª’ä½“</td>
                        <td>Reddit, Twitter</td>
                        <td>æ•°ç™¾GB</td>
                    </tr>
                </tbody>
            </table>

            <h3>æ•°æ®å¤„ç†æµç¨‹</h3>
            <div class="flow">
                <div class="flow-steps">
                    <div class="flow-step">åŸå§‹æ•°æ®é‡‡é›†</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">å»é‡è¿‡æ»¤</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">è´¨é‡ç­›é€‰</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">æ•æ„Ÿä¿¡æ¯å¤„ç†</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">Tokenization</div>
                </div>
            </div>

            <div class="cards">
                <div class="card">
                    <h3>ğŸ”„ å»é‡</h3>
                    <p>MinHash/SimHash å»é™¤é‡å¤æ–‡æ¡£ï¼Œå‡å°‘è®°å¿†è¿‡æ‹Ÿåˆ</p>
                </div>
                <div class="card">
                    <h3>âœ… è´¨é‡è¿‡æ»¤</h3>
                    <p>è¯­è¨€è¯†åˆ«ã€é•¿åº¦è¿‡æ»¤ã€å›°æƒ‘åº¦è¿‡æ»¤ã€æ¯’æ€§æ£€æµ‹</p>
                </div>
                <div class="card">
                    <h3>ğŸ”’ éšç§å¤„ç†</h3>
                    <p>ç§»é™¤ PIIï¼ˆä¸ªäººèº«ä»½ä¿¡æ¯ï¼‰ã€ç”µè¯ã€é‚®ç®±ã€åœ°å€</p>
                </div>
                <div class="card">
                    <h3">âœ‚ï¸ Tokenization</h3>
                        <p>BPE/SentencePiece åˆ†è¯ï¼Œæ„å»ºè¯è¡¨ï¼ˆ32K-100K tokensï¼‰</p>
                </div>
            </div>

            <div class="tip info"><strong>ğŸ’¡ æ•°æ®æ··åˆæ¯”ä¾‹</strong>
                <p style="margin-top:8px">LLaMAé…æ¯”å‚è€ƒï¼šCommon Crawl 67%, C4 15%, GitHub 4.5%, Wikipedia 4.5%, Books 4.5%,
                    ArXiv 2.5%, Stack Exchange 2%</p>
            </div>
        </section>

        <section id="pretrain" class="section">
            <h2>é¢„è®­ç»ƒ (Pre-training)</h2>
            <p>é¢„è®­ç»ƒé˜¶æ®µåœ¨æµ·é‡æ–‡æœ¬ä¸Šè®­ç»ƒæ¨¡å‹å­¦ä¹ è¯­è¨€è§„å¾‹ï¼Œé‡‡ç”¨è‡ªå›å½’è¯­è¨€å»ºæ¨¡ç›®æ ‡ã€‚</p>

            <h3>è®­ç»ƒç›®æ ‡</h3>
            <pre><code><span class="comment"># è¯­è¨€å»ºæ¨¡ç›®æ ‡ï¼šé¢„æµ‹ä¸‹ä¸€ä¸ªtoken</span>
<span class="comment"># æŸå¤±å‡½æ•°ï¼šäº¤å‰ç†µ</span>

loss = -âˆ‘ log P(x_t | x_1, x_2, ..., x_{t-1})

<span class="comment"># P(x_t | context) = softmax(W_out Â· h_t)</span>
<span class="comment"># h_t = Transformer(x_1, ..., x_{t-1})</span></code></pre>

            <h3>å…³é”®è¶…å‚æ•°</h3>
            <table>
                <thead>
                    <tr>
                        <th>å‚æ•°</th>
                        <th>å…¸å‹å€¼ï¼ˆ7Bæ¨¡å‹ï¼‰</th>
                        <th>è¯´æ˜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Batch Size</td>
                        <td>2M-4M tokens</td>
                        <td>å…¨å±€batchå¤§å°</td>
                    </tr>
                    <tr>
                        <td>Learning Rate</td>
                        <td>3e-4 â†’ 3e-5</td>
                        <td>ä½™å¼¦è¡°å‡è°ƒåº¦</td>
                    </tr>
                    <tr>
                        <td>Warmup Steps</td>
                        <td>2000</td>
                        <td>å­¦ä¹ ç‡é¢„çƒ­</td>
                    </tr>
                    <tr>
                        <td>Context Length</td>
                        <td>2048-4096</td>
                        <td>è®­ç»ƒæ—¶ä¸Šä¸‹æ–‡é•¿åº¦</td>
                    </tr>
                    <tr>
                        <td>Total Tokens</td>
                        <td>1T-2T</td>
                        <td>è®­ç»ƒtokenæ€»æ•°</td>
                    </tr>
                    <tr>
                        <td>Weight Decay</td>
                        <td>0.1</td>
                        <td>L2æ­£åˆ™åŒ–</td>
                    </tr>
                </tbody>
            </table>

            <h3>Scaling Laws</h3>
            <p>ç ”ç©¶è¡¨æ˜ï¼Œæ¨¡å‹æ€§èƒ½ä¸å‚æ•°é‡Nã€æ•°æ®é‡Dã€è®¡ç®—é‡Cå­˜åœ¨å¹‚å¾‹å…³ç³»ï¼š</p>
            <pre><code><span class="comment"># Chinchilla Scaling Law (æœ€ä¼˜é…æ¯”)</span>
è®­ç»ƒtokens â‰ˆ <span class="number">20</span> Ã— å‚æ•°é‡

<span class="comment"># ä¾‹å¦‚ï¼š7Bæ¨¡å‹ â†’ 140B tokens</span>
<span class="comment">#       70Bæ¨¡å‹ â†’ 1.4T tokens</span>

<span class="comment"># è®¡ç®—é¢„ç®—å›ºå®šæ—¶ï¼Œå‚æ•°å’Œæ•°æ®åº”ç­‰æ¯”ä¾‹æ‰©å±•</span></code></pre>
        </section>

        <section id="sft" class="section">
            <h2>æŒ‡ä»¤å¾®è°ƒ (Supervised Fine-Tuning)</h2>
            <p>SFTé˜¶æ®µä½¿ç”¨æŒ‡ä»¤-å›ç­”å¯¹æ•°æ®ï¼Œè®©æ¨¡å‹å­¦ä¼šéµå¾ªäººç±»æŒ‡ä»¤ã€‚</p>

            <h3>æ•°æ®æ ¼å¼</h3>
            <pre><code><span class="comment"># å…¸å‹çš„å¯¹è¯æ ¼å¼</span>
{
  <span class="string">"instruction"</span>: <span class="string">"è¯·è§£é‡Šé‡å­è®¡ç®—çš„åŸºæœ¬åŸç†"</span>,
  <span class="string">"input"</span>: <span class="string">""</span>,
  <span class="string">"output"</span>: <span class="string">"é‡å­è®¡ç®—æ˜¯åˆ©ç”¨é‡å­åŠ›å­¦åŸç†è¿›è¡Œä¿¡æ¯å¤„ç†çš„è®¡ç®—æ–¹å¼..."</span>
}

<span class="comment"># Chatæ¨¡æ¿æ ¼å¼</span>
&lt;|system|&gt;ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„åŠ©æ‰‹ã€‚&lt;|end|&gt;
&lt;|user|&gt;è¯·è§£é‡Šé‡å­è®¡ç®—çš„åŸºæœ¬åŸç†&lt;|end|&gt;
&lt;|assistant|&gt;é‡å­è®¡ç®—æ˜¯...&lt;|end|&gt;</code></pre>

            <h3>é«˜è´¨é‡SFTæ•°æ®æ¥æº</h3>
            <div class="cards">
                <div class="card">
                    <h3>ğŸ“ äººå·¥æ ‡æ³¨</h3>
                    <p>é›‡ä½£æ ‡æ³¨å›¢é˜Ÿç¼–å†™é«˜è´¨é‡é—®ç­”ï¼Œæˆæœ¬é«˜ä½†è´¨é‡æœ€å¥½</p>
                </div>
                <div class="card">
                    <h3>ğŸ¤– Self-Instruct</h3>
                    <p>ç”¨å¼ºæ¨¡å‹ç”ŸæˆæŒ‡ä»¤æ•°æ®ï¼Œå¦‚Alpacaã€Vicunaæ–¹æ³•</p>
                </div>
                <div class="card">
                    <h3">ğŸ“š å¼€æºæ•°æ®é›†</h3>
                        <p>FLAN, Dolly, OpenAssistant, ShareGPTç­‰</p>
                </div>
                <div class="card">
                    <h3">âœ¨ æ•°æ®è’¸é¦</h3>
                        <p>ä»GPT-4ç­‰å¼ºæ¨¡å‹è’¸é¦ç”Ÿæˆæ•°æ®</p>
                </div>
            </div>

            <h3>SFTè®­ç»ƒé…ç½®</h3>
            <table>
                <thead>
                    <tr>
                        <th>å‚æ•°</th>
                        <th>å…¸å‹å€¼</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>å­¦ä¹ ç‡</td>
                        <td>1e-5 ~ 5e-6</td>
                    </tr>
                    <tr>
                        <td>Epochs</td>
                        <td>2-3</td>
                    </tr>
                    <tr>
                        <td>Batch Size</td>
                        <td>64-128</td>
                    </tr>
                    <tr>
                        <td>æ•°æ®é‡</td>
                        <td>10K-100Kæ ·æœ¬</td>
                    </tr>
                </tbody>
            </table>

            <div class="tip success"><strong>ğŸ’¡ PEFTæ–¹æ³•ï¼ˆé«˜æ•ˆå¾®è°ƒï¼‰</strong>
                <p style="margin-top:8px"><strong>LoRA</strong>ï¼šåªè®­ç»ƒä½ç§©é€‚é…å™¨ï¼Œå‚æ•°é‡å‡å°‘99%<br>
                    <strong>QLoRA</strong>ï¼š4bité‡åŒ– + LoRAï¼Œå•å¡å¯å¾®è°ƒ65Bæ¨¡å‹<br>
                    <strong>Prefix Tuning</strong>ï¼šåªè®­ç»ƒå‰ç¼€å‘é‡
                </p>
            </div>
        </section>

        <section id="rlhf" class="section">
            <h2>RLHF äººç±»åé¦ˆå¼ºåŒ–å­¦ä¹ </h2>
            <p>é€šè¿‡äººç±»åå¥½åé¦ˆè¿›ä¸€æ­¥å¯¹é½æ¨¡å‹ï¼Œä½¿è¾“å‡ºæ›´å®‰å…¨ã€æœ‰å¸®åŠ©ã€è¯šå®ã€‚</p>

            <div class="phase">
                <div class="phase-header">
                    <div class="phase-num">1</div>
                    <div class="phase-title">æ”¶é›†åå¥½æ•°æ®</div>
                </div>
                <div class="phase-content">å¯¹äºåŒä¸€æŒ‡ä»¤ï¼Œæ”¶é›†æ¨¡å‹çš„å¤šä¸ªå›ç­”ï¼Œè®©äººç±»æ ‡æ³¨è€…é€‰æ‹©æ›´å¥½çš„å›ç­”ï¼Œå½¢æˆåå¥½å¯¹ (chosen, rejected)</div>
            </div>

            <div class="phase">
                <div class="phase-header">
                    <div class="phase-num">2</div>
                    <div class="phase-title">è®­ç»ƒå¥–åŠ±æ¨¡å‹ (RM)</div>
                </div>
                <div class="phase-content">è®­ç»ƒä¸€ä¸ªæ¨¡å‹å­¦ä¹ äººç±»åå¥½ï¼Œç»™å›ç­”æ‰“åˆ†ã€‚ç›®æ ‡ï¼šchosen å¾—åˆ† > rejected å¾—åˆ†</div>
            </div>

            <div class="phase">
                <div class="phase-header">
                    <div class="phase-num">3</div>
                    <div class="phase-title">PPO å¼ºåŒ–å­¦ä¹ </div>
                </div>
                <div class="phase-content">ç”¨å¥–åŠ±æ¨¡å‹çš„å¾—åˆ†ä½œä¸ºå¥–åŠ±ä¿¡å·ï¼Œé€šè¿‡PPOç®—æ³•ä¼˜åŒ–ç­–ç•¥æ¨¡å‹ï¼ŒåŒæ—¶ç”¨KLæ•£åº¦çº¦æŸé˜²æ­¢åç¦»å¤ªè¿œ</div>
            </div>

            <h3>RLHF æŸå¤±å‡½æ•°</h3>
            <pre><code><span class="comment"># å¥–åŠ±æ¨¡å‹è®­ç»ƒ</span>
L_RM = -log(Ïƒ(r(x, y_chosen) - r(x, y_rejected)))

<span class="comment"># PPOç›®æ ‡ï¼ˆç®€åŒ–ï¼‰</span>
L_PPO = E[min(r_t * A_t, clip(r_t, 1-Îµ, 1+Îµ) * A_t)]
      + Î² * KL(Ï€_Î¸ || Ï€_ref)  <span class="comment"># KLçº¦æŸ</span>

<span class="comment"># r_t = Ï€_Î¸(a|s) / Ï€_old(a|s)  æ¦‚ç‡æ¯”</span>
<span class="comment"># A_t = ä¼˜åŠ¿å‡½æ•°ï¼ˆåŸºäºå¥–åŠ±æ¨¡å‹æ‰“åˆ†ï¼‰</span></code></pre>

            <h3>DPOï¼šæ›´ç®€å•çš„æ›¿ä»£æ–¹æ¡ˆ</h3>
            <pre><code><span class="comment"># Direct Preference Optimization</span>
<span class="comment"># æ— éœ€è®­ç»ƒå¥–åŠ±æ¨¡å‹ï¼Œç›´æ¥ä»åå¥½æ•°æ®ä¼˜åŒ–</span>

L_DPO = -log Ïƒ(Î² * (log Ï€_Î¸(y_w|x) - log Ï€_ref(y_w|x)
                  - log Ï€_Î¸(y_l|x) + log Ï€_ref(y_l|x)))

<span class="comment"># y_w = chosen, y_l = rejected</span></code></pre>
        </section>

        <section id="infra" class="section">
            <h2>è®­ç»ƒåŸºç¡€è®¾æ–½</h2>

            <h3>ç¡¬ä»¶è¦æ±‚</h3>
            <table>
                <thead>
                    <tr>
                        <th>æ¨¡å‹è§„æ¨¡</th>
                        <th>é¢„è®­ç»ƒGPU</th>
                        <th>æ˜¾å­˜éœ€æ±‚</th>
                        <th>è®­ç»ƒæ—¶é—´</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>7B</td>
                        <td>64-128 Ã— A100 80G</td>
                        <td>~60GB/GPU</td>
                        <td>~3å‘¨</td>
                    </tr>
                    <tr>
                        <td>13B</td>
                        <td>128-256 Ã— A100 80G</td>
                        <td>~80GB/GPU</td>
                        <td>~4å‘¨</td>
                    </tr>
                    <tr>
                        <td>70B</td>
                        <td>512-1024 Ã— A100 80G</td>
                        <td>éœ€æ¨¡å‹å¹¶è¡Œ</td>
                        <td>~8å‘¨</td>
                    </tr>
                    <tr>
                        <td>175B+</td>
                        <td>æ•°åƒGPUé›†ç¾¤</td>
                        <td>å¤æ‚å¹¶è¡Œç­–ç•¥</td>
                        <td>æ•°æœˆ</td>
                    </tr>
                </tbody>
            </table>

            <h3>åˆ†å¸ƒå¼è®­ç»ƒç­–ç•¥</h3>
            <div class="cards">
                <div class="card">
                    <h3">ğŸ“Š æ•°æ®å¹¶è¡Œ (DP)</h3>
                        <p>æ¯ä¸ªGPUå®Œæ•´æ¨¡å‹ï¼Œä¸åŒæ•°æ®ï¼Œæ¢¯åº¦åŒæ­¥ã€‚<br>é€‚åˆï¼šæ¨¡å‹å¯æ”¾å…¥å•å¡</p>
                </div>
                <div class="card">
                    <h3">ğŸ§© æ¨¡å‹å¹¶è¡Œ (MP)</h3>
                        <p>æ¨¡å‹åˆ‡åˆ†åˆ°å¤šGPUï¼Œå¼ é‡å¹¶è¡ŒMegatron-LMã€‚<br>é€‚åˆï¼šå•å±‚æ”¾ä¸ä¸‹</p>
                </div>
                <div class="card">
                    <h3">ğŸ”— æµæ°´çº¿å¹¶è¡Œ (PP)</h3>
                        <p>æŒ‰å±‚åˆ‡åˆ†ï¼Œæµæ°´çº¿æ‰§è¡Œã€‚<br>é€‚åˆï¼šè¶…æ·±æ¨¡å‹</p>
                </div>
                <div class="card">
                    <h3">ğŸ’¾ ZeRO</h3>
                        <p>DeepSpeed ZeROï¼Œä¼˜åŒ–å™¨çŠ¶æ€åˆ†ç‰‡ã€‚<br>å¤§å¹…é™ä½æ˜¾å­˜å ç”¨</p>
                </div>
            </div>

            <h3>å¸¸ç”¨æ¡†æ¶</h3>
            <table>
                <thead>
                    <tr>
                        <th>æ¡†æ¶</th>
                        <th>ç‰¹ç‚¹</th>
                        <th>é€‚ç”¨åœºæ™¯</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>DeepSpeed</td>
                        <td>ZeROä¼˜åŒ–ï¼Œæ˜“ç”¨</td>
                        <td>é€šç”¨è®­ç»ƒ</td>
                    </tr>
                    <tr>
                        <td>Megatron-LM</td>
                        <td>å¼ é‡å¹¶è¡Œï¼Œé«˜æ•ˆ</td>
                        <td>è¶…å¤§æ¨¡å‹</td>
                    </tr>
                    <tr>
                        <td>FSDP</td>
                        <td>PyTorchåŸç”Ÿ</td>
                        <td>ä¸­ç­‰è§„æ¨¡</td>
                    </tr>
                    <tr>
                        <td>Colossal-AI</td>
                        <td>ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ</td>
                        <td>å¿«é€Ÿä¸Šæ‰‹</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="eval" class="section">
            <h2>è¯„ä¼°æ–¹æ³•</h2>

            <h3>åŸºå‡†æµ‹è¯•</h3>
            <table>
                <thead>
                    <tr>
                        <th>è¯„æµ‹é›†</th>
                        <th>èƒ½åŠ›</th>
                        <th>è¯´æ˜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>MMLU</td>
                        <td>çŸ¥è¯†ç†è§£</td>
                        <td>57ä¸ªå­¦ç§‘çš„é€‰æ‹©é¢˜</td>
                    </tr>
                    <tr>
                        <td>HellaSwag</td>
                        <td>å¸¸è¯†æ¨ç†</td>
                        <td>æƒ…æ™¯ç»­å†™</td>
                    </tr>
                    <tr>
                        <td>HumanEval</td>
                        <td>ä»£ç ç”Ÿæˆ</td>
                        <td>Pythonç¼–ç¨‹é¢˜</td>
                    </tr>
                    <tr>
                        <td>GSM8K</td>
                        <td>æ•°å­¦æ¨ç†</td>
                        <td>å°å­¦æ•°å­¦åº”ç”¨é¢˜</td>
                    </tr>
                    <tr>
                        <td>TruthfulQA</td>
                        <td>è¯šå®æ€§</td>
                        <td>æµ‹è¯•å¹»è§‰</td>
                    </tr>
                    <tr>
                        <td>MT-Bench</td>
                        <td>å¯¹è¯èƒ½åŠ›</td>
                        <td>å¤šè½®å¯¹è¯è¯„æµ‹</td>
                    </tr>
                </tbody>
            </table>

            <h3>è¯„ä¼°æ–¹å¼</h3>
            <div class="cards">
                <div class="card">
                    <h3">ğŸ“Š è‡ªåŠ¨è¯„æµ‹</h3>
                        <p>å›ºå®šç­”æ¡ˆæ¯”å¯¹ã€BLEU/ROUGEã€GPT-4æ‰“åˆ†</p>
                </div>
                <div class="card">
                    <h3">ğŸ‘¥ äººå·¥è¯„æµ‹</h3>
                        <p>è´¨é‡ã€æœ‰ç”¨æ€§ã€å®‰å…¨æ€§çš„äººå·¥æ‰“åˆ†</p>
                </div>
                <div class="card">
                    <h3">âš”ï¸ Arenaå¯¹æˆ˜</h3>
                        <p>æ¨¡å‹ä¸¤ä¸¤å¯¹æ¯”ï¼ŒEloæ’åï¼ˆå¦‚Chatbot Arenaï¼‰</p>
                </div>
            </div>
        </section>

        <section id="cost" class="section">
            <h2>æˆæœ¬ä¼°ç®—</h2>

            <h3>è®­ç»ƒæˆæœ¬å‚è€ƒ</h3>
            <table>
                <thead>
                    <tr>
                        <th>æ¨¡å‹è§„æ¨¡</th>
                        <th>GPUå°æ—¶</th>
                        <th>äº‘æˆæœ¬ä¼°ç®—</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>7B (1T tokens)</td>
                        <td>~100K A100å°æ—¶</td>
                        <td>$200K-400K</td>
                    </tr>
                    <tr>
                        <td>13B (1T tokens)</td>
                        <td>~200K A100å°æ—¶</td>
                        <td>$400K-800K</td>
                    </tr>
                    <tr>
                        <td>70B (2T tokens)</td>
                        <td>~1M A100å°æ—¶</td>
                        <td>$2M-5M</td>
                    </tr>
                    <tr>
                        <td>175B+</td>
                        <td>æ•°ç™¾ä¸‡GPUå°æ—¶</td>
                        <td>$10M+</td>
                    </tr>
                </tbody>
            </table>

            <div class="tip"><strong>ğŸ’¡ é™ä½æˆæœ¬çš„æ–¹æ³•</strong>
                <p style="margin-top:8px">
                    1. <strong>ä½¿ç”¨å¼€æºåŸºåº§</strong>ï¼šåŸºäºLLaMAç­‰ç»§ç»­è®­ç»ƒ<br>
                    2. <strong>é«˜æ•ˆå¾®è°ƒ</strong>ï¼šLoRA/QLoRAå¤§å¹…é™ä½èµ„æºéœ€æ±‚<br>
                    3. <strong>æ··åˆç²¾åº¦</strong>ï¼šBF16/FP16è®­ç»ƒèŠ‚çœæ˜¾å­˜<br>
                    4. <strong>Flash Attention</strong>ï¼šæå‡è®¡ç®—æ•ˆç‡<br>
                    5. <strong>Spotå®ä¾‹</strong>ï¼šä½¿ç”¨äº‘å‚å•†ç«ä»·å®ä¾‹
                </p>
            </div>

            <h3>ä¸ªäºº/å°å›¢é˜Ÿå¯è¡Œæ–¹æ¡ˆ</h3>
            <div class="cards">
                <div class="card">
                    <h3">ğŸ’» æœ¬åœ°å¾®è°ƒ 7B</h3>
                        <p>1-2å¼  RTX 4090 (24GB)<br>QLoRA + 4bité‡åŒ–<br>æˆæœ¬ï¼š~$3000ç¡¬ä»¶</p>
                </div>
                <div class="card">
                    <h3">â˜ï¸ äº‘ç«¯å¾®è°ƒ 13B</h3>
                        <p>4-8å¼  A100 40G<br>LoRAå¾®è°ƒ<br>æˆæœ¬ï¼š~$500-1000</p>
                </div>
                <div class="card">
                    <h3">ğŸš€ é¢„è®­ç»ƒ 1B</h3>
                        <p>8å¼  A100 80G<br>ä»å¤´è®­ç»ƒå°æ¨¡å‹<br>æˆæœ¬ï¼š~$5000-10000</p>
                </div>
            </div>
        </section>

        <div class="tip info"><strong>ğŸ“š æ¨èå­¦ä¹ èµ„æº</strong>
            <p style="margin-top:8px">
                â€¢ <strong>è®ºæ–‡</strong>ï¼šAttention is All You Need, GPT-3, InstructGPT, LLaMA<br>
                â€¢ <strong>è¯¾ç¨‹</strong>ï¼šStanford CS324, Andrej Karpathyçš„Let's Build GPT<br>
                â€¢ <strong>å®è·µ</strong>ï¼šnanoGPT, LLaMA-Factory, Axolotl<br>
                â€¢ <strong>æ¡†æ¶</strong>ï¼šHuggingFace Transformers, DeepSpeed
            </p>
        </div>
    </div>
    <script>document.querySelectorAll('.toc a').forEach(a => a.addEventListener('click', e => { e.preventDefault(); document.querySelector(a.getAttribute('href')).scrollIntoView({ behavior: 'smooth' }) }))</script>
</body>

</html>