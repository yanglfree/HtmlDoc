<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Androidç³»ç»Ÿå¯åŠ¨å®Œæ•´æµç¨‹ - å¿«é€ŸæŸ¥è¯¢æ‰‹å†Œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0d1117;
            --bg2: #161b22;
            --bg3: #21262d;
            --text: #e6edf3;
            --text2: #8b949e;
            --blue: #58a6ff;
            --green: #3fb950;
            --purple: #a371f7;
            --orange: #d29922;
            --cyan: #39c5cf;
            --red: #f85149;
            --border: #30363d
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 24px
        }

        .hero {
            text-align: center;
            padding: 48px 24px;
            margin-bottom: 48px;
            background: linear-gradient(135deg, rgba(63, 185, 80, 0.15), rgba(210, 153, 34, 0.15));
            border-radius: 16px;
            border: 1px solid var(--border)
        }

        .hero h1 {
            font-size: 34px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--green), var(--orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent
        }

        .hero p {
            color: var(--text2);
            font-size: 16px
        }

        .section {
            margin-bottom: 48px
        }

        .section h2 {
            font-size: 22px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px
        }

        .section h2::before {
            content: '';
            width: 4px;
            height: 22px;
            background: linear-gradient(var(--green), var(--orange));
            border-radius: 2px
        }

        .section h3 {
            font-size: 18px;
            margin: 24px 0 16px;
            color: var(--green)
        }

        p {
            margin-bottom: 16px;
            color: var(--text2)
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg3);
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 13px;
            color: var(--cyan)
        }

        pre {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.8;
            margin: 16px 0
        }

        pre code {
            background: none;
            padding: 0;
            color: var(--text)
        }

        .comment {
            color: var(--text2)
        }

        .keyword {
            color: var(--purple)
        }

        .string {
            color: var(--green)
        }

        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin: 20px 0
        }

        .card {
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            transition: all .2s
        }

        .card:hover {
            border-color: var(--green);
            transform: translateY(-2px)
        }

        .card h3 {
            font-size: 16px;
            color: var(--green);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px
        }

        .card p,
        .card li {
            font-size: 14px;
            color: var(--text2);
            margin: 0
        }

        .card ul {
            margin: 8px 0 0 16px
        }

        .tip {
            background: rgba(63, 185, 80, 0.1);
            border: 1px solid rgba(63, 185, 80, 0.3);
            border-radius: 12px;
            padding: 16px 20px;
            margin: 20px 0
        }

        .tip.warn {
            background: rgba(210, 153, 34, 0.1);
            border-color: rgba(210, 153, 34, 0.3)
        }

        .tip strong {
            display: block;
            margin-bottom: 6px;
            color: var(--green)
        }

        .tip.warn strong {
            color: var(--orange)
        }

        .timeline {
            position: relative;
            padding-left: 32px;
            margin: 24px 0
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border)
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
            padding: 16px 20px;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 12px
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -28px;
            top: 20px;
            width: 12px;
            height: 12px;
            background: var(--green);
            border-radius: 50%;
            border: 2px solid var(--bg)
        }

        .timeline-item.kernel::before {
            background: var(--purple)
        }

        .timeline-item.init::before {
            background: var(--orange)
        }

        .timeline-item.zygote::before {
            background: var(--blue)
        }

        .timeline-item.system::before {
            background: var(--cyan)
        }

        .timeline-item.launcher::before {
            background: var(--green)
        }

        .timeline-item h4 {
            font-size: 15px;
            margin-bottom: 8px;
            color: var(--text)
        }

        .timeline-item p {
            font-size: 13px;
            color: var(--text2);
            margin: 0
        }

        .timeline-item code {
            font-size: 12px
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            background: var(--bg2);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            margin: 16px 0
        }

        th {
            background: var(--bg3);
            padding: 14px 16px;
            text-align: left;
            font-weight: 600
        }

        td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border)
        }

        tr:last-child td {
            border-bottom: none
        }

        .flow {
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0
        }

        .flow-title {
            font-size: 14px;
            color: var(--text2);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px
        }

        .flow-steps {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px
        }

        .flow-step {
            background: var(--bg3);
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 13px;
            font-weight: 500
        }

        .flow-arrow {
            color: var(--green);
            font-size: 16px
        }

        .toc {
            position: fixed;
            top: 40px;
            right: 40px;
            width: 200px;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px
        }

        .toc h3 {
            font-size: 12px;
            color: var(--text2);
            text-transform: uppercase;
            margin-bottom: 12px
        }

        .toc a {
            display: block;
            padding: 6px 0;
            color: var(--text2);
            text-decoration: none;
            font-size: 13px
        }

        .toc a:hover {
            color: var(--green)
        }

        @media(max-width:1200px) {
            .toc {
                display: none
            }
        }

        @media(max-width:768px) {
            .container {
                padding: 24px 16px
            }

            .hero h1 {
                font-size: 26px
            }

            .cards {
                grid-template-columns: 1fr
            }

            .flow-steps {
                flex-direction: column
            }

            .flow-arrow {
                transform: rotate(90deg)
            }
        }
    </style>
</head>

<body>
    <nav class="toc">
        <h3>ç›®å½•</h3><a href="#overview">å¯åŠ¨æ¦‚è§ˆ</a><a href="#boot">BootLoader</a><a href="#kernel">Linuxå†…æ ¸</a><a
            href="#init">Initè¿›ç¨‹</a><a href="#zygote">Zygoteè¿›ç¨‹</a><a href="#system">SystemServer</a><a
            href="#launcher">Launcherå¯åŠ¨</a><a href="#summary">æµç¨‹æ€»ç»“</a>
    </nav>

    <div class="container">
        <div class="hero">
            <h1>ğŸš€ Androidç³»ç»Ÿå¯åŠ¨å®Œæ•´æµç¨‹</h1>
            <p>ä»æŒ‰ä¸‹ç”µæºé”®åˆ°æ˜¾ç¤ºæ¡Œé¢çš„å®Œæ•´æŠ€æœ¯è§£æ</p>
        </div>

        <section id="overview" class="section">
            <h2>å¯åŠ¨æµç¨‹æ¦‚è§ˆ</h2>
            <p>Androidç³»ç»Ÿå¯åŠ¨æ˜¯ä¸€ä¸ªä»ç¡¬ä»¶åˆ°è½¯ä»¶ã€ä»åº•å±‚åˆ°åº”ç”¨å±‚çš„å±‚å±‚åˆå§‹åŒ–è¿‡ç¨‹ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹é˜¶æ®µï¼š</p>

            <div class="flow">
                <div class="flow-title">å¯åŠ¨é˜¶æ®µæ€»è§ˆ</div>
                <div class="flow-steps">
                    <div class="flow-step">ğŸ”Œ BootLoader</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">ğŸ§ Linux Kernel</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">âš™ï¸ Init è¿›ç¨‹</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">ğŸ¥š Zygote</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">ğŸ“± SystemServer</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">ğŸ  Launcher</div>
                </div>
            </div>

            <div class="cards">
                <div class="card">
                    <h3>â±ï¸ å¯åŠ¨æ—¶é—´åˆ†å¸ƒ</h3>
                    <ul>
                        <li>BootLoader: ~1-2ç§’</li>
                        <li>Kernel: ~3-5ç§’</li>
                        <li>Init/Zygote: ~5-10ç§’</li>
                        <li>SystemServer: ~10-20ç§’</li>
                        <li>æ€»è®¡: ~20-40ç§’</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>ğŸ”‘ å…³é”®è¿›ç¨‹</h3>
                    <ul>
                        <li><code>init</code> - PID 1ï¼Œæ‰€æœ‰è¿›ç¨‹ä¹‹çˆ¶</li>
                        <li><code>zygote</code> - æ‰€æœ‰Appè¿›ç¨‹ä¹‹çˆ¶</li>
                        <li><code>system_server</code> - ç³»ç»ŸæœåŠ¡è¿›ç¨‹</li>
                        <li><code>surfaceflinger</code> - æ˜¾ç¤ºæœåŠ¡</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="boot" class="section">
            <h2>BootLoader é˜¶æ®µ</h2>
            <p>æŒ‰ä¸‹ç”µæºé”®åï¼Œé¦–å…ˆæ‰§è¡Œçš„æ˜¯å›ºåŒ–åœ¨ROMä¸­çš„å¼•å¯¼ç¨‹åºã€‚</p>

            <div class="timeline">
                <div class="timeline-item">
                    <h4>1. Boot ROM</h4>
                    <p>CPUä¸Šç”µåæ‰§è¡Œå›ºåŒ–åœ¨èŠ¯ç‰‡å†…éƒ¨ROMçš„ä»£ç ï¼Œåˆå§‹åŒ–ç¡¬ä»¶æ—¶é’Ÿå’Œå†…å­˜ï¼ŒåŠ è½½BootLoaderåˆ°RAM</p>
                </div>
                <div class="timeline-item">
                    <h4>2. BootLoader (å¦‚ U-Boot)</h4>
                    <p>åˆå§‹åŒ–ç¡¬ä»¶å¤–è®¾ã€æ£€æµ‹å¯åŠ¨æ¨¡å¼ï¼ˆæ­£å¸¸/Recovery/Fastbootï¼‰ã€åŠ è½½Kernelé•œåƒåˆ°å†…å­˜</p>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>å¯åŠ¨æ¨¡å¼</th>
                        <th>è§¦å‘æ–¹å¼</th>
                        <th>ç”¨é€”</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Normal Boot</td>
                        <td>æ­£å¸¸å¼€æœº</td>
                        <td>å¯åŠ¨Androidç³»ç»Ÿ</td>
                    </tr>
                    <tr>
                        <td>Recovery</td>
                        <td>éŸ³é‡+/ç”µæºç»„åˆ</td>
                        <td>ç³»ç»Ÿæ¢å¤ã€åˆ·æœº</td>
                    </tr>
                    <tr>
                        <td>Fastboot</td>
                        <td>éŸ³é‡-/ç”µæºç»„åˆ</td>
                        <td>åˆ·å†™åˆ†åŒºã€è§£é”</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="kernel" class="section">
            <h2>Linux Kernel é˜¶æ®µ</h2>
            <p>BootLoaderåŠ è½½å®ŒKernelé•œåƒåï¼Œè·³è½¬æ‰§è¡ŒLinuxå†…æ ¸ä»£ç ã€‚</p>

            <div class="timeline">
                <div class="timeline-item kernel">
                    <h4>1. Kernel è§£å‹ä¸åˆå§‹åŒ–</h4>
                    <p>è§£å‹zImageï¼Œè®¾ç½®å†…å­˜ç®¡ç†ã€ä¸­æ–­æ§åˆ¶å™¨ã€åˆå§‹åŒ–è°ƒåº¦å™¨</p>
                </div>
                <div class="timeline-item kernel">
                    <h4>2. é©±åŠ¨åŠ è½½</h4>
                    <p>åŠ è½½è®¾å¤‡é©±åŠ¨ï¼šæ˜¾ç¤ºã€è§¦æ‘¸ã€å­˜å‚¨ã€USBã€WiFiç­‰</p>
                </div>
                <div class="timeline-item kernel">
                    <h4>3. æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ</h4>
                    <p>æŒ‚è½½systemã€vendorã€dataç­‰åˆ†åŒº</p>
                </div>
                <div class="timeline-item kernel">
                    <h4>4. å¯åŠ¨ init è¿›ç¨‹</h4>
                    <p>å†…æ ¸å¯åŠ¨å®Œæˆåï¼Œæ‰§è¡Œ <code>/system/bin/init</code>ï¼Œè¿™æ˜¯ç”¨æˆ·ç©ºé—´çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ (PID=1)</p>
                </div>
            </div>

            <pre><code><span class="comment">// Kernel å¯åŠ¨æµç¨‹ (ç®€åŒ–)</span>
start_kernel()
â”œâ”€â”€ setup_arch()           <span class="comment">// æ¶æ„ç›¸å…³åˆå§‹åŒ–</span>
â”œâ”€â”€ mm_init()              <span class="comment">// å†…å­˜ç®¡ç†åˆå§‹åŒ–</span>
â”œâ”€â”€ sched_init()           <span class="comment">// è°ƒåº¦å™¨åˆå§‹åŒ–</span>
â”œâ”€â”€ init_IRQ()             <span class="comment">// ä¸­æ–­åˆå§‹åŒ–</span>
â”œâ”€â”€ rest_init()
â”‚   â””â”€â”€ kernel_init()
â”‚       â””â”€â”€ run_init_process(<span class="string">"/system/bin/init"</span>)  <span class="comment">// å¯åŠ¨init</span></code></pre>
        </section>

        <section id="init" class="section">
            <h2>Init è¿›ç¨‹</h2>
            <p>Initæ˜¯Androidç”¨æˆ·ç©ºé—´çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œè´Ÿè´£è§£æinit.rcé…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨å…³é”®å®ˆæŠ¤è¿›ç¨‹ã€‚</p>

            <h3>Init ä¸»è¦èŒè´£</h3>
            <div class="cards">
                <div class="card">
                    <h3>ğŸ“œ è§£æ init.rc</h3>
                    <p>è¯»å–å¹¶æ‰§è¡Œ <code>/system/etc/init/*.rc</code> é…ç½®æ–‡ä»¶ä¸­çš„å‘½ä»¤å’ŒæœåŠ¡å®šä¹‰</p>
                </div>
                <div class="card">
                    <h3>ğŸ”§ å±æ€§æœåŠ¡</h3>
                    <p>å¯åŠ¨ property_serviceï¼Œç®¡ç†ç³»ç»Ÿå±æ€§ï¼ˆç±»ä¼¼æ³¨å†Œè¡¨ï¼‰</p>
                </div>
                <div class="card">
                    <h3>ğŸ‘¶ å¯åŠ¨å­è¿›ç¨‹</h3>
                    <p>fork å‡º ueventdã€logdã€servicemanagerã€surfaceflingerã€zygote ç­‰</p>
                </div>
                <div class="card">
                    <h3>ğŸ‘€ è¿›ç¨‹ç›‘æ§</h3>
                    <p>ä½œä¸ºçˆ¶è¿›ç¨‹ï¼Œç›‘æ§å­è¿›ç¨‹çŠ¶æ€ï¼Œå¿…è¦æ—¶é‡å¯å´©æºƒçš„æœåŠ¡</p>
                </div>
            </div>

            <h3>init.rc å…³é”®é…ç½®</h3>
            <pre><code><span class="comment"># /system/core/rootdir/init.zygote64.rc</span>

<span class="keyword">service</span> zygote /system/bin/app_process64 -Xzygote /system/bin \
    --zygote --start-system-server
    <span class="keyword">class</span> main
    <span class="keyword">priority</span> -20
    <span class="keyword">socket</span> zygote stream 660 root system
    <span class="keyword">socket</span> usap_pool_primary stream 660 root system
    <span class="keyword">onrestart</span> restart audioserver
    <span class="keyword">onrestart</span> restart cameraserver
    <span class="keyword">onrestart</span> restart media</code></pre>

            <h3>Init å¯åŠ¨é¡ºåº</h3>
            <div class="flow">
                <div class="flow-steps">
                    <div class="flow-step">å±æ€§æœåŠ¡</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">ueventd</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">logd</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">servicemanager</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">surfaceflinger</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">zygote</div>
                </div>
            </div>
        </section>

        <section id="zygote" class="section">
            <h2>Zygote è¿›ç¨‹</h2>
            <p>Zygoteï¼ˆå­µåŒ–å™¨ï¼‰æ˜¯æ‰€æœ‰Androidåº”ç”¨è¿›ç¨‹å’ŒSystemServerçš„çˆ¶è¿›ç¨‹ï¼Œé€šè¿‡forkæœºåˆ¶å¿«é€Ÿåˆ›å»ºæ–°è¿›ç¨‹ã€‚</p>

            <div class="timeline">
                <div class="timeline-item zygote">
                    <h4>1. å¯åŠ¨è™šæ‹Ÿæœº</h4>
                    <p>åˆ›å»ºå¹¶åˆå§‹åŒ– ART/Dalvik è™šæ‹Ÿæœºï¼ŒåŠ è½½ç³»ç»Ÿç±»å’Œèµ„æº</p>
                </div>
                <div class="timeline-item zygote">
                    <h4>2. é¢„åŠ è½½èµ„æº</h4>
                    <p>é¢„åŠ è½½å¸¸ç”¨Javaç±»ã€Androidèµ„æºã€å…±äº«åº“ï¼ˆæå‡Appå¯åŠ¨é€Ÿåº¦ï¼‰</p>
                </div>
                <div class="timeline-item zygote">
                    <h4>3. åˆ›å»º Socket</h4>
                    <p>åˆ›å»º /dev/socket/zygote ç”¨äºæ¥æ”¶ AMS çš„forkè¯·æ±‚</p>
                </div>
                <div class="timeline-item zygote">
                    <h4>4. Fork SystemServer</h4>
                    <p>Zygote å¯åŠ¨åçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ fork å‡º SystemServer è¿›ç¨‹</p>
                </div>
                <div class="timeline-item zygote">
                    <h4>5. å¾ªç¯ç­‰å¾…</h4>
                    <p>è¿›å…¥å¾ªç¯ï¼Œç­‰å¾… Socket è¯·æ±‚ä»¥ fork æ–°çš„ App è¿›ç¨‹</p>
                </div>
            </div>

            <pre><code><span class="comment">// ZygoteInit.java æ ¸å¿ƒæµç¨‹</span>
<span class="keyword">public static void</span> main(String argv[]) {
    <span class="comment">// 1. åˆ›å»ºZygoteServerï¼ˆSocketæœåŠ¡ç«¯ï¼‰</span>
    ZygoteServer zygoteServer = <span class="keyword">new</span> ZygoteServer();
    
    <span class="comment">// 2. é¢„åŠ è½½èµ„æº</span>
    preload();  <span class="comment">// åŠ è½½ç±»ã€èµ„æºã€å…±äº«åº“</span>
    
    <span class="comment">// 3. åˆ›å»ºSocket</span>
    zygoteServer.createZygoteSocket(socketName);
    
    <span class="comment">// 4. Fork SystemServer</span>
    <span class="keyword">if</span> (startSystemServer) {
        Runnable r = forkSystemServer();
        <span class="keyword">if</span> (r != <span class="keyword">null</span>) {
            r.run();  <span class="comment">// åœ¨SystemServerè¿›ç¨‹ä¸­æ‰§è¡Œ</span>
            <span class="keyword">return</span>;
        }
    }
    
    <span class="comment">// 5. Zygoteè¿›ç¨‹è¿›å…¥å¾ªç¯ç­‰å¾…</span>
    zygoteServer.runSelectLoop();
}</code></pre>

            <div class="tip"><strong>ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ Zygoteï¼Ÿ</strong>
                <p style="margin-top:8px">é€šè¿‡ fork å·²ç»åŠ è½½äº†è™šæ‹Ÿæœºå’Œç³»ç»Ÿèµ„æºçš„ Zygoteï¼Œæ–°Appè¿›ç¨‹å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›èµ„æºï¼ˆCOWæœºåˆ¶ï¼‰ï¼Œæ— éœ€é‡æ–°åŠ è½½ï¼Œå¤§å¹…æå‡Appå¯åŠ¨é€Ÿåº¦ã€‚</p>
            </div>
        </section>

        <section id="system" class="section">
            <h2>SystemServer è¿›ç¨‹</h2>
            <p>SystemServer æ˜¯ Android ç³»ç»ŸæœåŠ¡çš„å®¿ä¸»è¿›ç¨‹ï¼Œè¿è¡Œç€ AMSã€WMSã€PMS ç­‰æ ¸å¿ƒæœåŠ¡ã€‚</p>

            <h3>å…³é”®ç³»ç»ŸæœåŠ¡</h3>
            <table>
                <thead>
                    <tr>
                        <th>æœåŠ¡</th>
                        <th>ç±»å</th>
                        <th>èŒè´£</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>AMS</td>
                        <td>ActivityManagerService</td>
                        <td>å››å¤§ç»„ä»¶ç®¡ç†ã€è¿›ç¨‹ç®¡ç†</td>
                    </tr>
                    <tr>
                        <td>WMS</td>
                        <td>WindowManagerService</td>
                        <td>çª—å£ç®¡ç†ã€è¾“å…¥äº‹ä»¶åˆ†å‘</td>
                    </tr>
                    <tr>
                        <td>PMS</td>
                        <td>PackageManagerService</td>
                        <td>åº”ç”¨å®‰è£…ã€æƒé™ç®¡ç†</td>
                    </tr>
                    <tr>
                        <td>PKMS</td>
                        <td>PowerManagerService</td>
                        <td>ç”µæºç®¡ç†ã€WakeLock</td>
                    </tr>
                    <tr>
                        <td>IMS</td>
                        <td>InputManagerService</td>
                        <td>è¾“å…¥äº‹ä»¶ç®¡ç†</td>
                    </tr>
                    <tr>
                        <td>NMS</td>
                        <td>NotificationManagerService</td>
                        <td>é€šçŸ¥ç®¡ç†</td>
                    </tr>
                </tbody>
            </table>

            <h3>æœåŠ¡å¯åŠ¨é¡ºåº</h3>
            <pre><code><span class="comment">// SystemServer.java</span>
<span class="keyword">private void</span> run() {
    <span class="comment">// 1. å¼•å¯¼æœåŠ¡ï¼ˆæœ€å…ˆå¯åŠ¨ï¼Œå…¶ä»–æœåŠ¡ä¾èµ–ï¼‰</span>
    startBootstrapServices();
    <span class="comment">// â†’ AMS, PMS, PKMS, DisplayManagerService</span>
    
    <span class="comment">// 2. æ ¸å¿ƒæœåŠ¡</span>
    startCoreServices();
    <span class="comment">// â†’ BatteryService, UsageStatsService</span>
    
    <span class="comment">// 3. å…¶ä»–æœåŠ¡</span>
    startOtherServices();
    <span class="comment">// â†’ WMS, IMS, NMS, ConnectivityService...</span>
    
    <span class="comment">// 4. ç³»ç»Ÿå°±ç»ª</span>
    mActivityManagerService.systemReady(() -> {
        <span class="comment">// å¯åŠ¨Launcher</span>
        startHomeActivity();
    });
}</code></pre>

            <div class="cards">
                <div class="card">
                    <h3>ğŸ”„ Binder æœºåˆ¶</h3>
                    <p>å„æœåŠ¡é€šè¿‡ ServiceManager æ³¨å†Œï¼Œåº”ç”¨é€šè¿‡ Binder IPC è°ƒç”¨ç³»ç»ŸæœåŠ¡</p>
                </div>
                <div class="card">
                    <h3>ğŸ“¡ ç³»ç»Ÿå°±ç»ªå›è°ƒ</h3>
                    <p>æ‰€æœ‰æœåŠ¡å¯åŠ¨åï¼ŒAMS å‘é€ systemReady å›è°ƒï¼Œè§¦å‘å¯åŠ¨ Launcher</p>
                </div>
            </div>
        </section>

        <section id="launcher" class="section">
            <h2>Launcher å¯åŠ¨</h2>
            <p>SystemServer å‡†å¤‡å°±ç»ªåï¼ŒAMS ä¼šå¯åŠ¨é»˜è®¤çš„ Launcher åº”ç”¨ï¼ˆæ¡Œé¢ï¼‰ï¼Œç”¨æˆ·çœ‹åˆ°ä¸»å±å¹•ã€‚</p>

            <div class="timeline">
                <div class="timeline-item launcher">
                    <h4>1. AMS å‘èµ·å¯åŠ¨è¯·æ±‚</h4>
                    <p>AMS.systemReady() ä¸­è°ƒç”¨ startHomeActivity()ï¼Œæ ¹æ® Intent æŸ¥æ‰¾ Launcher</p>
                </div>
                <div class="timeline-item launcher">
                    <h4>2. Zygote Fork è¿›ç¨‹</h4>
                    <p>AMS é€šè¿‡ Socket è¯·æ±‚ Zygote fork å‡º Launcher è¿›ç¨‹</p>
                </div>
                <div class="timeline-item launcher">
                    <h4>3. åˆ›å»º Application</h4>
                    <p>æ–°è¿›ç¨‹ä¸­åˆ›å»º Application å®ä¾‹ï¼Œè°ƒç”¨ onCreate()</p>
                </div>
                <div class="timeline-item launcher">
                    <h4>4. å¯åŠ¨ Activity</h4>
                    <p>åˆ›å»º LauncherActivityï¼Œå®Œæˆå¸ƒå±€æ¸²æŸ“ï¼Œæ˜¾ç¤ºæ¡Œé¢</p>
                </div>
            </div>

            <pre><code><span class="comment">// ActivityManagerService.java</span>
<span class="keyword">void</span> startHomeActivity(Intent intent, ActivityInfo aInfo) {
    <span class="comment">// æŸ¥æ‰¾ Category.HOME çš„ Activity</span>
    intent.setComponent(<span class="keyword">new</span> ComponentName(
        aInfo.applicationInfo.packageName, aInfo.name));
    
    <span class="comment">// å¯åŠ¨åˆ°ä¸»å±ä»»åŠ¡æ ˆ</span>
    mActivityStartController.startHomeActivity(intent, aInfo);
}</code></pre>

            <div class="tip"><strong>ğŸ‰ å¯åŠ¨å®Œæˆæ ‡å¿—</strong>
                <p style="margin-top:8px">å½“ Launcher çš„ Activity.onResume() æ‰§è¡Œå®Œæˆï¼Œå¼€æœºåŠ¨ç”»ç»“æŸï¼Œç”¨æˆ·çœ‹åˆ°æ¡Œé¢å›¾æ ‡ï¼Œæ•´ä¸ªç³»ç»Ÿå¯åŠ¨æµç¨‹å®Œæˆã€‚</p>
            </div>
        </section>

        <section id="summary" class="section">
            <h2>æµç¨‹æ€»ç»“</h2>
            <pre><code><span class="comment">// Android ç³»ç»Ÿå¯åŠ¨å®Œæ•´æµç¨‹</span>

<span class="string">æŒ‰ä¸‹ç”µæºé”®</span>
    â”‚
    â–¼
<span class="keyword">[BootLoader]</span> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚  Boot ROM â†’ BootLoader â†’ åŠ è½½ Kernel
    â–¼
<span class="keyword">[Linux Kernel]</span> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚  ç¡¬ä»¶åˆå§‹åŒ– â†’ é©±åŠ¨åŠ è½½ â†’ æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ
    â”‚  â””â”€â†’ å¯åŠ¨ init è¿›ç¨‹ (PID=1)
    â–¼
<span class="keyword">[Init è¿›ç¨‹]</span> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚  è§£æ init.rc â†’ å±æ€§æœåŠ¡ â†’ å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹
    â”‚  â””â”€â†’ å¯åŠ¨ zygote æœåŠ¡
    â–¼
<span class="keyword">[Zygote è¿›ç¨‹]</span> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚  åˆ›å»ºè™šæ‹Ÿæœº â†’ é¢„åŠ è½½èµ„æº â†’ åˆ›å»º Socket
    â”‚  â””â”€â†’ fork SystemServer
    â–¼
<span class="keyword">[SystemServer]</span> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚  å¼•å¯¼æœåŠ¡ â†’ æ ¸å¿ƒæœåŠ¡ â†’ å…¶ä»–æœåŠ¡
    â”‚  AMS / WMS / PMS / ...
    â”‚  â””â”€â†’ systemReady() â†’ å¯åŠ¨ Launcher
    â–¼
<span class="keyword">[Launcher]</span> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚  Zygote fork â†’ åˆ›å»º Application â†’ å¯åŠ¨ Activity
    â”‚  â””â”€â†’ æ˜¾ç¤ºæ¡Œé¢ âœ…
    â–¼
<span class="string">ç³»ç»Ÿå¯åŠ¨å®Œæˆ</span></code></pre>

            <div class="cards">
                <div class="card">
                    <h3>ğŸ”‘ æ ¸å¿ƒè¦ç‚¹</h3>
                    <ul>
                        <li>Init æ˜¯ç”¨æˆ·ç©ºé—´ç¬¬ä¸€ä¸ªè¿›ç¨‹</li>
                        <li>Zygote æ˜¯æ‰€æœ‰Appçš„çˆ¶è¿›ç¨‹</li>
                        <li>SystemServer è¿è¡Œæ ¸å¿ƒç³»ç»ŸæœåŠ¡</li>
                        <li>é€šè¿‡ fork æœºåˆ¶å¿«é€Ÿå¯åŠ¨App</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>ğŸ“š å…³é”®æºç ä½ç½®</h3>
                    <ul>
                        <li>Init: <code>system/core/init/</code></li>
                        <li>Zygote: <code>frameworks/base/core/java/com/android/internal/os/ZygoteInit.java</code></li>
                        <li>SystemServer:
                            <code>frameworks/base/services/java/com/android/server/SystemServer.java</code></li>
                    </ul>
                </div>
            </div>
        </section>
    </div>
    <script>document.querySelectorAll('.toc a').forEach(a => a.addEventListener('click', e => { e.preventDefault(); document.querySelector(a.getAttribute('href')).scrollIntoView({ behavior: 'smooth' }) }))</script>
</body>

</html>